#+PROPERTY: header-args:sql  :tangle ./test.sql :engine postgres

#+name: front-page-events
#+begin_src sql
  SELECT events.id, events.title FROM events;
#+end_src

#+RESULTS: front-page-events
| id                                   | title                      |
|--------------------------------------+----------------------------|
| 5f16c000-17ec-44fc-8f7e-0c045f5e8381 | First Entropy catchup meet |

#+name: past-events
#+begin_src sql
  SELECT events.id, events.title, (events.end_time - events.start_time) AS interval FROM events WHERE events.start_time < now();
#+end_src

#+RESULTS: past-events
| id | title | interval |
|----+-------+----------|

#+name: groups
#+begin_src sql
  SELECT groups.name, groups.slug, source, source_link FROM groups;
#+end_src
#+RESULTS: groups
| name    | slug    | source | source_link |
|---------+---------+--------+-------------|
| Entropy | entropy | local  |             |

#+name: event_sections
#+begin_src sql
    SELECT
      events.slug,
      logo,
      format('%s mins', extract(epoch from (event_sections.end_time - event_sections.start_time))/60) as duration
      FROM
        ("event_sections" INNER JOIN "events" ON "events"."id" = "event_sections"."event_id");
#+end_src
#+RESULTS: event_sections
| slug                       | logo                   | duration |
|----------------------------+------------------------+----------|
| first-entropy-catchup-meet |                        | 10 mins  |
| first-entropy-catchup-meet | logos/dark/agenda.svg  | 40 mins  |
| first-entropy-catchup-meet | logos/dark/pitcher.svg | 40 mins  |

#+name: initiatives
#+begin_src sql :engine postgres
  SELECT initiatives.slug from initiatives left join goals on initiatives.slug = goals.initiative_slug where goals.slug is null;
#+end_src
#+RESULTS: initiatives
| slug |
|------|

#+name: goals
#+begin_src sql :engine postgres
  SELECT
    title, slug, initiative_slug, target,
    justify_interval(iteration_interval) AS iteration_interval
  FROM goals;
#+end_src
#+RESULTS: goals
| title                   | slug                     | initiative_slug     | target | iteration_interval |
|-------------------------+--------------------------+---------------------+--------+--------------------|
| 10 monthly active users | ten-monthly-active-users | meager-tech-culture |     10 | 7 days             |
